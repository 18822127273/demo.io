"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[9855],{9855:function(e,i,t){t.r(i),t.d(i,{default:function(){return S}});var s=function(){var e=this,i=e._self._c;return i("div",{staticClass:"full"},[i("dv-border-box-13",[i("div",{staticClass:"amap-wrapper"},[i("div",{attrs:{id:"cesiumDemo"}}),i("transition",{attrs:{name:"el-fade-in-linear"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.buildMessageBoxShow,expression:"buildMessageBoxShow"}],staticClass:"buildMessageBox messageBox"},[i("div",{staticClass:"topLine"}),i("div",{staticClass:"slantLine"}),i("div",{staticClass:"title"},[i("span",{staticClass:"messageBoxTit"},[e._v(e._s(e.name))])]),i("div",{staticClass:"contList"},[i("span",{staticClass:"messageBoxTit"},[e._v("楼栋数：")]),i("span",{staticClass:"messageVal"},[e._v("80")])]),i("div",{staticClass:"contList"},[i("span",{staticClass:"messageBoxTit"},[e._v("户数：")]),i("span",{staticClass:"messageVal"},[e._v("314")])]),i("div",{staticClass:"contList"},[i("span",{staticClass:"messageBoxTit"},[e._v("人数：")]),i("span",{staticClass:"messageVal"},[e._v("1149")])]),i("div",{staticClass:"contList"},[i("span",{staticClass:"messageBoxTit"},[e._v("党员数：")]),i("span",{staticClass:"messageVal"},[e._v("124人")])])])])],1),i("div",{staticStyle:{position:"absolute",left:"10px"}},[i("back-button")],1),i("div",{staticClass:"btnContainer"},[i("button",{on:{click:function(i){return e.draw("Polyline")}}},[e._v("标点测距")]),i("button",{on:{click:function(i){return e.draw("Polygon")}}},[e._v("标点测面")]),i("button",{on:{click:function(i){return e.clearAllDrawn()}}},[e._v("清空数据")]),i("div",{staticClass:"tip"},[i("p",[e._v("点击按钮后，在场景内单击左键标点，单击右键结束测量。")]),i("p",[e._v("点击“标点测距”按钮后在场景内单击鼠标左键加点，在两点间显示距离，单击右键结束测量。")]),i("p",[e._v("点击“标点测面”按钮后在场景内单击鼠标左键加点，单击右键在勾出的范围中显示面积。")]),i("p",[e._v("点击“清空数据”按钮删除所有数据。")])])])])],1)},n=[];t(7658),t(8499);function o(e){let i=Cesium.Cartesian3.fromArray([0,0,-170]),t=Cesium.Matrix4.fromTranslation(i),s=new Cesium.Cesium3DTileset({url:"http://localhost:9003/model/WktjX1Mi/tileset.json",modelMatrix:t,maximumScreenSpaceError:64,maximumMemoryUsage:512,dynamicScreenSpaceErrorDensity:1});e.scene.primitives.add(s),e.scene.sun.show=!1,e.scene.skyBox.show=!1,e.scene.screenSpaceCameraController.minimumZoomDistance=50,e.cesiumWidget.creditContainer.style.display="none",s.readyPromise.then((function(i){e.scene.primitives.add(i);var t=10,s=i.boundingSphere,n=Cesium.Cartographic.fromCartesian(s.center),o=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,0),a=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,t),r=Cesium.Cartesian3.subtract(a,o,new Cesium.Cartesian3);i.modelMatrix=Cesium.Matrix4.fromTranslation(r),e.zoomTo(i,new Cesium.HeadingPitchRange(.5,-.2,1*i.boundingSphere.radius))})),e.zoomTo(s)}function a(e,i,t){e.entities.add({position:Cesium.Cartesian3.fromDegrees(i[t].x,i[t].y,i[t].z),label:{text:i[t].Text,font:"14pt Source Han Sans CN",fillColor:Cesium.Color.WHITE,backgroundColor:Cesium.Color.BLUE,showBackground:!0,outline:!0,outlineColor:Cesium.Color.WHITE,outlineWidth:2,scale:1,style:Cesium.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,pixelOffset:new Cesium.Cartesian2(10,0),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e3),show:!0}})}function r(e,i,t){e.entities.add({id:i[t].id,name:'{"cesiumType": "cylinderBuilding"}',position:Cesium.Cartesian3.fromDegrees(i[t].x,i[t].y,10),orientation:Cesium.Transforms.headingPitchRollQuaternion(new Cesium.Cartesian3.fromDegrees(i[t].x,i[t].y,10),new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(140),Cesium.Math.toRadians(0),Cesium.Math.toRadians(0))),cylinder:{length:50,topRadius:100,bottomRadius:100,material:Cesium.Color.fromCssColorString("rgba(255,255,255,0.01)"),slices:100,numberOfVerticalLines:100}})}function l(e,i){let t=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(i),n=new Cesium.EllipsoidGeodesic;return n.setEndPoints(t,s),(n.surfaceDistance/1e3).toFixed(2)}function u(e,i){let t=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(i),n=new Cesium.EllipsoidGeodesic;n.setEndPoints(t,s);let o=n.interpolateUsingFraction(.5);return Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}function c(e,i,t){let s=e.entities.add({name:"中点",position:i,label:{text:t+"km",font:"20px sans-serif",fillColor:Cesium.Color.WHITE,outlineWidth:2,backgroundColor:Cesium.Color.BLACK,showBackground:!0,style:Cesium.LabelStyle.FILL,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY}});return s}function m(e,i){let t=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(i),n=t.latitude,o=t.longitude,a=s.latitude,r=s.longitude,l=-Math.atan2(Math.sin(o-r)*Math.cos(a),Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(o-r));return l<0&&(l+=2*Math.PI),l}function p(e,i,t){let s=e.entities.add({name:"多边形面积",position:t[t.length-1],label:{text:i+"平方公里",font:"20px sans-serif",fillColor:Cesium.Color.WHITE,outlineWidth:2,backgroundColor:Cesium.Color.BLACK,showBackground:!0,style:Cesium.LabelStyle.FILL,pixelOffset:new Cesium.Cartesian2(60,-60),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY}});return s}function C(e,i,t){let s=e.entities.add({name:"点几何对象",position:i,point:{color:Cesium.Color.WHEAT,pixelSize:5,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND},label:{text:t,font:"30px sans-serif",fillColor:Cesium.Color.WHITE,outlineWidth:2,backgroundColor:Cesium.Color.BLACK,showBackground:!0,style:Cesium.LabelStyle.FILL,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,horizontalOrigin:Cesium.HorizontalOrigin.CENTER}});return s}function d(e,i){let t=e.entities.add({position:i,point:{color:Cesium.Color.WHEAT,pixelSize:5,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});return t}function h(e,i){if(i.length<1)return;let t=e.entities.add({name:"线几何对象",polyline:{positions:i,width:5,material:new Cesium.PolylineGlowMaterialProperty({color:Cesium.Color.WHEAT}),depthFailMaterial:new Cesium.PolylineGlowMaterialProperty({color:Cesium.Color.WHEAT}),clampToGround:!0}});return t}function g(e,i){if(i.length<2)return;let t=e.entities.add({name:"面几何对象",polygon:{hierarchy:i,material:new Cesium.ColorMaterialProperty(Cesium.Color.WHEAT.withAlpha(.4))}});return t}let f,y;var T={data(){return{viewer:void 0,tempEntities:[],pointNum:0,floatingPoint:void 0,activeShape:void 0,name:"",config:{num:100,content:"{nt}"},buildMessageBoxShow:!1,mapMouseDown:!1,layered:{first:{center:{x:-2716017.9098884147,y:4733221.085409288,z:3290520.383644969},priipt1:0,priipt2:0,priipt3:0,priipt4:0,priipt5:0,priipt6:48,priipt7:240,priipt8:240,priipt9:60},second:{center:{x:-2715916.7808021326,y:4733118.934902318,z:3290749.2402792173},priipt1:0,priipt2:0,priipt3:0,priipt4:-25,priipt5:-8,priipt6:42,priipt7:200,priipt8:200,priipt9:50}},lablelists:[{x:"120.80302807741732",y:"31.30709242677048",z:40,Text:"1"},{x:"120.80408198509431",y:"31.30709242677048",Text:"2",z:40}],building:{first:{cylinder1:100,id:"first",x:"119.8480302488737",y:"31.259695847684014"},second:{cylinder1:100,id:"second",x:"119.84770232077288",y:"31.26175225162898"}},enitylist:[]}},mounted(){this.getCesiumDem();const e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout((()=>{e.close()}),2e3)},methods:{pointAngle(e,i,t){let s=m(i,e),n=m(i,t),o=s-n;return o<0&&(o+=2*Math.PI),o},getArea(e){let i=0;for(let t=0;t<e.length-2;t++){let s=(t+1)%e.length,n=(t+2)%e.length,o=this.pointAngle(e[t],e[s],e[n]),a=l(e[s],e[0]),r=l(e[n],e[0]);i+=a*r*Math.sin(o)/2}return i=i.toFixed(2),i=parseFloat(i),Math.abs(i)},clearAllDrawn(){this.tempEntities=[],this.pointNum=0,f.entities.removeAll(),o(f);for(var e=0;e<this.lablelists.length;e++){let i=e,t=this.lablelists;a(f,t,i)}let i=this.building;r(f,i,"first"),r(f,i,"second")},draw(e){let i=this,t=this.tempEntities,s=this.floatingPoint,n=this.activeShape,o=[],a=[],r=[],m=new Cesium.ScreenSpaceEventHandler(f.scene.canvas);switch(e){case"Polyline":f.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),m.setInputAction((function(e){if(Cesium.defined(s)){let i=f.scene.pickPosition(e.endPosition);Cesium.defined(i)&&(s.position.setValue(i),r.pop(),r.push(i))}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),m.setInputAction((function(e){let n=f.scene.pickPosition(e.position);Cesium.defined(n)&&(s=d(f,n));let r=f.camera.getPickRay(e.position);o=f.scene.globe.pick(r,f.scene),a.push(o),i.pointNum+=1;let m=a.length,p=C(f,a[a.length-1],JSON.stringify(i.pointNum));if(t.push(p),m>1){let e=l(a[a.length-2],a[a.length-1]),i=u(a[a.length-2],a[a.length-1]),s=h(f,[a[a.length-2],a[a.length-1]]),n=c(f,i,e);t.push(s),t.push(n)}}),Cesium.ScreenSpaceEventType.LEFT_CLICK),m.setInputAction((function(e){r.pop(),f.entities.remove(r),f.entities.remove(s),a=[],m.destroy(),m=null,s=void 0,n=void 0,r=[]}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);break;case"Polygon":f.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),m.setInputAction((function(e){if(Cesium.defined(s)){let i=f.scene.pickPosition(e.endPosition);Cesium.defined(i)&&(s.position.setValue(i),r.pop(),r.push(i))}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),m.setInputAction((function(e){let l=f.scene.pickPosition(e.position);if(Cesium.defined(l)){if(0===r.length){s=d(f,l),r.push(l);const e=new Cesium.CallbackProperty((function(){return new Cesium.PolygonHierarchy(r)}),!1);n=g(f,e)}r.push(l)}let u=f.camera.getPickRay(e.position);o=f.scene.globe.pick(u,f.scene),a.push(o);let c=a.length;i.pointNum+=1;let m=C(f,a[a.length-1],JSON.stringify(i.pointNum));if(t.push(m),c>1){let e=h(f,[a[a.length-2],a[a.length-1]]);t.push(e)}}),Cesium.ScreenSpaceEventType.LEFT_CLICK),m.setInputAction((function(e){let n=f.camera.pickEllipsoid(e.position,f.scene.globe.ellipsoid);if(n){let e=a.length;if(e<3)alert("闭合操作需要至少3个点嗷");else{let e=h(f,[a[0],a[a.length-1]]);t.push(e),g(f,a);let s=i.getArea(a);p(f,JSON.stringify(s),a),t.push(a),m.destroy(),m=null}}r.pop(),f.entities.remove(r),f.entities.remove(s),s=void 0,r=[]}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);break}},layeredTilesModel(e){let i=f.scene;y&&y.destroy();var t=new Cesium.Cartesian3(this.layered[e].center.x,this.layered[e].center.y,this.layered[e].center.z),s=Cesium.Transforms.eastNorthUpToFixedFrame(t),n=Cesium.Matrix3.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Number(this.layered[e].priipt1),Number(this.layered[e].priipt2),Number(this.layered[e].priipt3))),o=Cesium.Matrix4.fromRotationTranslation(n,new Cesium.Cartesian3(Number(this.layered[e].priipt4),Number(this.layered[e].priipt5),Number(this.layered[e].priipt6)));Cesium.Matrix4.multiply(s,o,s),y=i.primitives.add(new Cesium.ClassificationPrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:Cesium.BoxGeometry.fromDimensions({vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,dimensions:new Cesium.Cartesian3(Number(this.layered[e].priipt7),Number(this.layered[e].priipt8),Number(this.layered[e].priipt9))}),modelMatrix:s,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString("#D22809").withAlpha(.5)),show:new Cesium.ShowGeometryInstanceAttribute(!0)}}),classificationType:Cesium.ClassificationType.CESIUM_3D_TILE}))},getCesiumDem(){let e=this;Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkNjgwMDgwNS1mMzFmLTQ3ODItYmRhOS1hYjNhMTFkM2I0N2YiLCJpZCI6MTMxMDkwLCJpYXQiOjE2ODAwNjU0MTZ9.nvutxZY3TNl8df3PURG96km6EFH85SmlzWCW-75QHuE",f=new Cesium.Viewer("cesiumDemo",{animation:!1,baseLayerPicker:!1,geocoder:!1,timeline:!1,sceneModePicker:!0,navigationHelpButton:!1,infoBox:!0,fullscreenButton:!1,selectionIndicator:!1,scene3DOnly:!0,homeButton:!1,terrainProvider:new Cesium.EllipsoidTerrainProvider({})}),f.terrainProvider=Cesium.createWorldTerrain({requestWaterMask:!0,requestVertexNormals:!0}),o(f);for(var i=0;i<e.lablelists.length;i++){let t=i,s=e.lablelists;a(f,s,t)}let t=e.building;r(f,t,"first"),r(f,t,"second");let s=f.scene;var n=Cesium.createWorldTerrain({requestVertexNormals:!0});f.terrainProvider=n,f.scene.globe.enableLighting=!0;let l=s.globe.ellipsoid,u=f.entities.add({label:{show:!1}}),c=null,m=null,p=null,C=new Cesium.ScreenSpaceEventHandler(s.canvas);C.setInputAction((function(i){!0===e.mapMouseDown&&(e.buildMessageBoxShow=!1,y&&y.destroy())}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),C.setInputAction((function(i){e.mapMouseDown=!0}),Cesium.ScreenSpaceEventType.LEFT_DOWN),C.setInputAction((function(i){e.mapMouseDown=!1}),Cesium.ScreenSpaceEventType.LEFT_UP),C.setInputAction((function(i){let t=f.camera.pickEllipsoid(i.position,l);if(t){let s=l.cartesianToCartographic(t);c=Cesium.Math.toDegrees(s.longitude),m=Cesium.Math.toDegrees(s.latitude),p=Math.ceil(f.camera.positionCartographic.height),u.position=t;let n=f.scene.pick(i.position);if(Cesium.defined(n)&&n)if(n.id&&n.id.name){let i=JSON.parse(n.id.name);if("cylinderBuilding"===i.cesiumType){e.buildMessageBoxShow=!0;let i=f.scene.cartesianToCanvasCoordinates(n.id.position._value),t=n.id.id;e.name=t,e.layeredTilesModel(n.id.id),setTimeout((()=>{let e=document.querySelector(".buildMessageBox"),t=e.offsetWidth,s=e.offsetHeight;e.style.left=Math.floor(i.x)-t/2+230+"px",e.style.top=Math.floor(i.y)-s-70+"px"}),10)}}else e.buildMessageBoxShow=!1,y&&y.destroy();else e.buildMessageBoxShow=!1,y&&y.destroy()}else u.label.show=!1}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}}},v=T,b=t(1001),E=(0,b.Z)(v,s,n,!1,null,null,null),S=E.exports}}]);
//# sourceMappingURL=9855.5f4e0e38.js.map